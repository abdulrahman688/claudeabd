<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ - Ù…Ù†ØµØ© Ø§Ù„Ù†Ù‡Ø¶Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Cairo -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="../assets/css/main.css">
</head>

<body class="bg-gradient-to-br from-green-50 to-green-100 min-h-screen flex items-center justify-center p-4">

  <div class="w-full max-w-2xl">

    <!-- Logo & Back -->
    <div class="text-center mb-8">
      <a href="index.html" class="inline-flex items-center gap-2 text-green-700 hover:text-green-800 mb-4">
        <i class="fas fa-arrow-right"></i>
        <span>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </a>

      <div class="w-20 h-20 bg-gradient-to-br from-green-600 to-green-800 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-seedling text-white text-3xl"></i>
      </div>

      <h1 class="text-3xl font-black text-gray-900">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø¶Ø©! ğŸŒ¸</h1>
      <p class="text-gray-600 mt-2">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù…Ù† Ø§Ù„Ø´ÙØ§Ø¡ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø¶Ø© - Ù…Ø¬Ø§Ù†Ø§Ù‹</p>
    </div>

    <!-- Register Form -->
    <div class="bg-white rounded-2xl shadow-xl p-8">

      <!-- Progress Indicator -->
      <div class="mb-8">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-semibold text-green-600">Ø§Ù„Ø®Ø·ÙˆØ© <span id="currentStep">1</span> Ù…Ù† 3</span>
          <span class="text-sm text-gray-600" id="stepTitle">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
        </div>
        <div class="progress-bar">
          <div id="progressBar" class="h-full bg-green-600 transition-all duration-300" style="width: 33%"></div>
        </div>
      </div>

      <!-- Alert Container -->
      <div id="alert-container" class="mb-4"></div>

      <form id="registerForm">

        <!-- Step 1: Basic Info -->
        <div id="step1" class="form-step">

          <div class="mb-6">
            <label class="form-label" for="username">
              <i class="fas fa-user ml-2"></i>
              Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            </label>
            <input
              type="text"
              id="username"
              name="username"
              class="form-input"
              placeholder="Ø§Ø®ØªØ± Ø§Ø³Ù…Ø§Ù‹ ÙØ±ÙŠØ¯Ø§Ù‹ (3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)"
              required
            />
            <p class="text-xs text-gray-500 mt-1">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø± Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø®ØµÙˆØµÙŠØªÙƒ</p>
          </div>

          <div class="mb-6">
            <label class="form-label" for="password">
              <i class="fas fa-lock ml-2"></i>
              ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            </label>
            <div class="relative">
              <input
                type="password"
                id="password"
                name="password"
                class="form-input pr-12"
                placeholder="8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"
                required
              />
              <button
                type="button"
                onclick="togglePassword('password', 'toggleIcon1')"
                class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
              >
                <i class="fas fa-eye" id="toggleIcon1"></i>
              </button>
            </div>
          </div>

          <div class="mb-6">
            <label class="form-label" for="confirmPassword">
              <i class="fas fa-lock ml-2"></i>
              ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            </label>
            <div class="relative">
              <input
                type="password"
                id="confirmPassword"
                name="confirmPassword"
                class="form-input pr-12"
                placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                required
              />
              <button
                type="button"
                onclick="togglePassword('confirmPassword', 'toggleIcon2')"
                class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
              >
                <i class="fas fa-eye" id="toggleIcon2"></i>
              </button>
            </div>
          </div>

          <button
            type="button"
            onclick="nextStep(2)"
            class="w-full px-6 py-4 bg-green-600 text-white rounded-lg font-bold text-lg hover:bg-green-700 transition shadow-lg"
          >
            Ø§Ù„ØªØ§Ù„ÙŠ
            <i class="fas fa-arrow-left mr-2"></i>
          </button>

        </div>

        <!-- Step 2: Location -->
        <div id="step2" class="form-step hidden">

          <div class="mb-6">
            <label class="form-label" for="country">
              <i class="fas fa-globe ml-2"></i>
              Ø§Ù„Ø¨Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
            </label>
            <select id="country" name="country" class="form-input">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯</option>
              <option value="Syria">Ø³ÙˆØ±ÙŠØ§</option>
              <option value="Turkey">ØªØ±ÙƒÙŠØ§</option>
              <option value="Lebanon">Ù„Ø¨Ù†Ø§Ù†</option>
              <option value="Jordan">Ø§Ù„Ø£Ø±Ø¯Ù†</option>
              <option value="Germany">Ø£Ù„Ù…Ø§Ù†ÙŠØ§</option>
              <option value="Other">Ø£Ø®Ø±Ù‰</option>
            </select>
          </div>

          <div class="mb-6">
            <label class="form-label" for="city">
              <i class="fas fa-map-marker-alt ml-2"></i>
              Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            </label>
            <input
              type="text"
              id="city"
              name="city"
              class="form-input"
              placeholder="Ø¯Ù…Ø´Ù‚ØŒ Ø­Ù„Ø¨ØŒ Ø¥Ø¯Ù„Ø¨..."
            />
          </div>

          <div class="mb-6">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" id="isDisplaced" class="w-5 h-5 text-green-600 rounded">
              <span class="text-gray-700">Ø£Ø¹ÙŠØ´ Ø®Ø§Ø±Ø¬ Ø³ÙˆØ±ÙŠØ§ Ø­Ø§Ù„ÙŠØ§Ù‹</span>
            </label>
          </div>

          <div class="flex gap-4">
            <button
              type="button"
              onclick="prevStep(1)"
              class="flex-1 px-6 py-4 bg-gray-200 text-gray-700 rounded-lg font-bold text-lg hover:bg-gray-300 transition"
            >
              <i class="fas fa-arrow-right ml-2"></i>
              Ø§Ù„Ø³Ø§Ø¨Ù‚
            </button>
            <button
              type="button"
              onclick="nextStep(3)"
              class="flex-1 px-6 py-4 bg-green-600 text-white rounded-lg font-bold text-lg hover:bg-green-700 transition shadow-lg"
            >
              Ø§Ù„ØªØ§Ù„ÙŠ
              <i class="fas fa-arrow-left mr-2"></i>
            </button>
          </div>

        </div>

        <!-- Step 3: Goals -->
        <div id="step3" class="form-step hidden">

          <div class="mb-6">
            <label class="form-label">
              <i class="fas fa-bullseye ml-2"></i>
              Ù…Ø§ Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬Ù‡ Ø£ÙƒØ«Ø±ØŸ
            </label>

            <div class="space-y-3">
              <label class="flex items-start gap-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-500 transition">
                <input type="checkbox" name="needs" value="healing" class="mt-1 w-5 h-5 text-green-600 rounded">
                <div>
                  <div class="font-semibold text-gray-900">ğŸ•Šï¸ Ø¯Ø¹Ù… Ù†ÙØ³ÙŠ ÙˆØ§Ø³ØªØ±Ø®Ø§Ø¡</div>
                  <div class="text-sm text-gray-600">Ø£Ø±ÙŠØ¯ Ø£Ù† Ø£Ø´Ø¹Ø± Ø¨ØªØ­Ø³Ù† ÙˆØ£ØªØ¹Ø§ÙÙ‰ Ù†ÙØ³ÙŠØ§Ù‹</div>
                </div>
              </label>

              <label class="flex items-start gap-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-500 transition">
                <input type="checkbox" name="needs" value="learning" class="mt-1 w-5 h-5 text-green-600 rounded">
                <div>
                  <div class="font-semibold text-gray-900">ğŸ“š ØªØ¹Ù„Ù… Ù…Ù‡Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
                  <div class="text-sm text-gray-600">Ø£Ø±ÙŠØ¯ ØªØ¹Ù„Ù… Ù…Ù‡Ø§Ø±Ø§Øª ØªØ³Ø§Ø¹Ø¯Ù†ÙŠ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„</div>
                </div>
              </label>

              <label class="flex items-start gap-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-500 transition">
                <input type="checkbox" name="needs" value="earning" class="mt-1 w-5 h-5 text-green-600 rounded">
                <div>
                  <div class="font-semibold text-gray-900">ğŸ’¼ ÙØ±Øµ Ø¹Ù…Ù„ ÙˆØ¯Ø®Ù„</div>
                  <div class="text-sm text-gray-600">Ø£Ø­ØªØ§Ø¬ Ù…ØµØ¯Ø± Ø¯Ø®Ù„ ÙˆÙØ±Øµ Ø¹Ù…Ù„</div>
                </div>
              </label>
            </div>
          </div>

          <div class="mb-6">
            <label class="flex items-start gap-3 cursor-pointer">
              <input type="checkbox" id="terms" required class="mt-1 w-5 h-5 text-green-600 rounded">
              <span class="text-sm text-gray-700">
                Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰
                <a href="#" class="text-green-600 hover:underline">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a>
                Ùˆ
                <a href="#" class="text-green-600 hover:underline">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
              </span>
            </label>
          </div>

          <div class="flex gap-4">
            <button
              type="button"
              onclick="prevStep(2)"
              class="flex-1 px-6 py-4 bg-gray-200 text-gray-700 rounded-lg font-bold text-lg hover:bg-gray-300 transition"
            >
              <i class="fas fa-arrow-right ml-2"></i>
              Ø§Ù„Ø³Ø§Ø¨Ù‚
            </button>
            <button
              type="submit"
              id="submitBtn"
              class="flex-1 px-6 py-4 bg-green-600 text-white rounded-lg font-bold text-lg hover:bg-green-700 transition shadow-lg"
            >
              <i class="fas fa-rocket ml-2"></i>
              Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ
            </button>
          </div>

        </div>

      </form>

      <!-- Login Link -->
      <div class="text-center mt-6">
        <p class="text-gray-600">
          Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ
          <a href="login.html" class="text-green-600 hover:text-green-700 font-semibold">
            Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
          </a>
        </p>
      </div>

    </div>

  </div>

  <!-- Scripts -->
  <script src="../assets/js/main.js"></script>
  <script src="../assets/js/api.js"></script>
  <script>
    let currentStep = 1;

    // Toggle Password Visibility
    function togglePassword(inputId, iconId) {
      const input = document.getElementById(inputId);
      const icon = document.getElementById(iconId);

      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    }

    // Show Alert
    function showAlert(message, type = 'error') {
      const container = document.getElementById('alert-container');
      container.innerHTML = `
        <div class="alert alert-${type}">
          ${message}
        </div>
      `;
      container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // Update Progress
    function updateProgress(step) {
      document.getElementById('currentStep').textContent = step;
      document.getElementById('progressBar').style.width = `${(step / 3) * 100}%`;

      const titles = ['Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', 'Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'Ø§Ù„Ø£Ù‡Ø¯Ø§Ù'];
      document.getElementById('stepTitle').textContent = titles[step - 1];
    }

    // Next Step
    function nextStep(step) {
      // Validate current step
      if (currentStep === 1) {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (!username || username.length < 3) {
          showAlert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
          return;
        }

        if (!password || password.length < 8) {
          showAlert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
          return;
        }

        if (password !== confirmPassword) {
          showAlert('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
          return;
        }
      }

      // Hide current step
      document.getElementById(`step${currentStep}`).classList.add('hidden');

      // Show next step
      currentStep = step;
      document.getElementById(`step${step}`).classList.remove('hidden');

      // Update progress
      updateProgress(step);
    }

    // Previous Step
    function prevStep(step) {
      document.getElementById(`step${currentStep}`).classList.add('hidden');
      currentStep = step;
      document.getElementById(`step${step}`).classList.remove('hidden');
      updateProgress(step);
    }

    // Handle Form Submission
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      // Validate terms
      if (!document.getElementById('terms').checked) {
        showAlert('ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…');
        return;
      }

      // Collect data
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const country = document.getElementById('country').value;
      const city = document.getElementById('city').value.trim();
      const isDisplaced = document.getElementById('isDisplaced').checked;

      // Collect needs
      const needs = Array.from(document.querySelectorAll('input[name="needs"]:checked'))
        .map(cb => cb.value);

      const userData = {
        username,
        password,
        country: country || undefined,
        city: city || undefined,
        isDisplaced,
        language: 'ar'
      };

      // Show loading
      const submitBtn = document.getElementById('submitBtn');
      const originalText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="spinner mx-auto"></div>';

      try {
        // Call register API
        const response = await api.register(userData);

        // Success
        showAlert('ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø¶Ø© ğŸŒ¸', 'success');

        // Redirect to dashboard after 2 seconds
        setTimeout(() => {
          window.location.href = 'dashboard.html';
        }, 2000);

      } catch (error) {
        showAlert(error.message || 'ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }
    });

    // Check if already logged in
    if (isAuthenticated()) {
      window.location.href = 'dashboard.html';
    }
  </script>

</body>
</html>
